(SELECT
  RBVQTTXM_ARC.NOVIN NOVIN,
  RBVQTTXM_ARC.DATCCLT DATCCLT,
  RBVQTFAM_restriction.VPVU VPVU,
  RBVQTM10.DATMEC DATMEC,
  RBVQTTXM_ARC.TYPUTIL TYPUTIL,
  RBVQTVEH.INDDEMO INDDEMO,
  sum(case when RBVQTTXM_ARC.NOVIN is NOT NULL then RBVQTTXM_ARC.NEDC end) CO2MIXTE,
  RBVQTTXM_ARC.HABEXTT HABEXTT,
  RBVQTTXM_ARC.HABEXTC HABEXTC,
  RBVQTFAM_restriction.FAMILLE FAMILLE,
  RBVQTFAM_restriction.LIBFAMI LIBFAMI,
  RBVQTTXM_ARC.COD_MOTOR COD_MOTOR,
  RBVQTTXM_ARC.DATVENT DATVENT,
  RBVQTTFF.LIBELLE_FRANCAIS LIBELLE_FRANCAIS,
  RBVQTFAM_restriction.MARQUE MARQUE,
  RBVQTM10.DATDEM DATDEM,
  CASE WHEN ( RBVQTFLL.QC_FILIAL ) IN (1,63) THEN RBVQTM10.DATIMM ELSE RBVQTVEH.DATIMMAT END DATIMMAT,
  RBVQTCDC.CODOP1 CODOP1,
  RBVQTCDC.CODOP2 CODOP2,
  RBVQTCDC.CODOP3 CODOP3,
  RBVQTCDC.CODOP4 CODOP4,
  RBVQTCDC.CODOP5 CODOP5,
  RBVQTCDC.CODPROM CODPROM,
  RBVQTCDC.CODPROM2 CODPROM2,
  RBVQTCDC.REMIPOUR REMIPOUR,
  RBVQTVEH.DATMAD DATMAD,
  RBVQTVEH.DATEXPC DATEXPC,
  RBVQTVEH.DATARCR DATARCR,
  RBVQTCCO.LIBCOMBIPACK LIBCOMBIPACK,
  RBVQTTXM_ARC.CODCPRO CODCPRO,
  Table__129.LIBELLE LIBELLE,
  RBVQTVEH.DATPROD DATPROD,
  RBVQTCAF.DATMRES DATMRES

FROM
  df_rbvqttxm_arc RBVQTTXM_ARC,
  df_rbvqttff RBVQTTFF
  LEFT OUTER JOIN df_rbvqtcdc RBVQTCDC ON RBVQTTXM_ARC.QI_FILIAL=RBVQTCDC.QI_FILIAL and RBVQTTXM_ARC.NUMCCLT=RBVQTCDC.NUMCCLT
  JOIN  df_rbvqtfll RBVQTFLL ON RBVQTTFF.QI_FILIAL=RBVQTFLL.QC_FILIAL and RBVQTTXM_ARC.QI_FILIAL=RBVQTFLL.QC_FILIAL
  LEFT OUTER JOIN df_rbvqtlm1 RBVQTLM1 ON RBVQTTXM_ARC.COD_MOTOR=RBVQTLM1.COD_MOTOR and RBVQTTXM_ARC.QI_FILIAL=RBVQTLM1.QI_FILIAL
  LEFT OUTER JOIN df_rbvqtveh RBVQTVEH ON RBVQTTXM_ARC.QI_FILIAL=RBVQTVEH.QI_FILIAL and RBVQTTXM_ARC.NOVIN=RBVQTVEH.NOVIN
  LEFT OUTER JOIN df_rbvqttut RBVQTTUT_TXM ON RBVQTTXM_ARC.TYPUTIL=RBVQTTUT_TXM.TYPUTIL and RBVQTTXM_ARC.QI_FILIAL=RBVQTTUT_TXM.QI_FILIAL
  LEFT OUTER JOIN df_rbvqtcco RBVQTCCO ON RBVQTTXM_ARC.QI_FILIAL=RBVQTCCO.QI_FILIAL and RBVQTTXM_ARC.CODCPER=RBVQTCCO.CODCPER and RBVQTTXM_ARC.VERSION_CCO=RBVQTCCO.VERSION
  LEFT OUTER JOIN df_rbvqtcaf RBVQTCAF ON RBVQTTXM_ARC.NOCAF=RBVQTCAF.NOCAF and RBVQTTXM_ARC.QI_FILIAL=RBVQTCAF.QI_FILIAL
  LEFT OUTER JOIN df_rbvqtm10 RBVQTM10 ON RBVQTTXM_ARC.QI_FILIAL=RBVQTM10.QI_FILIAL and RBVQTTXM_ARC.NOVIN=RBVQTM10.NOVIN
  LEFT OUTER JOIN (SELECT CODPSA as CODPSA,  MAX(LITCTP) as LIBELLE FROM df_rbvqtctp RBVQTCTP GROUP BY CODPSA ) Table__129 ON RBVQTTXM_ARC.CODCPRO=Table__129.CODPSA
  JOIN  df_rbvqtfam RBVQTFAM_restriction ON RBVQTTXM_ARC.VPVU=RBVQTFAM_restriction.VPVU and SUBSTR(RBVQTTXM_ARC.VERS14, 1, 4)=RBVQTFAM_restriction.FAMILLE

  WHERE  RBVQTFAM_restriction.QI_FILIAL IN ('83','84')
  AND RBVQTTFF.LIBELLE_FRANCAIS  IN  ( 'France' , 'Allemagne' , 'Portugal' , 'Autriche' , 'Belgique' , 'Italie' , 'Espagne' , 'Gde-Bretagne' , 'Pays Bas' , 'Pologne'  )
  AND RBVQTFAM_restriction.MARQUE  IN  ( 'AP' ,'AC', 'DS'  )
  AND RBVQTTXM_ARC.DATVENT BETWEEN TO_DATE('{0}', 'dd/MM/yyyy') AND TO_DATE('{1}', 'dd/MM/yyyy')
  ORDER BY RBVQTTXM_ARC.DATVENT
  )